<%= provide(:title, @organization.name) %>

<div class="hide-on-small-and-down" style="padding-top: 32px"></div>
<div class="hide-on-small-and-down" style="padding-top: 32px"></div>
<div class="row">
  <div class="z-depth-2 white col s12 m10 offset-m1 l6 offset-l3" style="position: relative">


    <div class="row">
      <div class="col s12">
        <!--<%= render "shared/grid_helper" %>-->
        <h4>Current Members:</h4>
        <ul class="collection">
          <% @employees.each do |user| %>
            <li class="collection-item avatar">
              <img src="http://placekitten.com/g/50/50" alt="" class="circle">
              <span class="title"></span>
              <p><%= User.find(user.user_id).email %>
              </p>
            </li>
          <% end %>
        </ul>
        <div class="divider"></div>

        <h4>Invite New Members</h4>
        <p class="flow-text">Emails placed here will be automatically sent an email inviting them to join this organization</p>
        <%= form_tag organization_send_invites_path(@organization) do %>
          <div class="row">
            <div class="col s6 center">
              <a href="javascript:" id="add_new_email" class="hide-on-small-and-down"><i class="material-icons" style="position: relative; top: 6px; padding-bottom: 4px">add</i>Add Invite</a>
            </div>
            <div class="col s6">
              <%= submit_tag "Send Invites", class: "btn-small theia_blue right hide-on-small-and-down"%>
            </div>
            <br>
            <div id="emails_form">
            </div>
            <div class="col s12 center">
              <%= submit_tag "Send Invites", class: "btn-large theia_blue hide-on-med-and-up"%>
              <div class="fixed-action-btn">
                <a href="javascript:" id="add_new_email_mobile" class="btn-floating btn-large waves-effect waves-light red hide-on-med-and-up"><i class="material-icons">add</i></a>
              </div>
            </div>
          </div>
          <br>
        <% end %>
        <div class="divider"></div>
      </div>
    </div>
  </div>
</div>

<div class="hide" id="new_emails_form">
  <div class="input-field col s11 m8 offset-m2 l6">
    <%= text_field_tag 'emails[]', nil, class:"email_input_field", autocomplete: "off" %>
    <%= label_tag 'Email' %>
    <i class="material-icons clear_email right">clear</i>
  </div>
</div>

<script>
    $(document).ready(function(){

        function key_press_check(e) {
            if (e.keyCode == 9){
                add_field();
                update_form();
            }
        }

        $("#add_new_email").click(function(){
            add_field();
            update_form();
            $("#emails_form .input-field:last input").focus();
        });

        $("#add_new_email_mobile").click(function(){
            add_field();
            update_form();
            $("#emails_form .input-field:last input").focus();
        });

        function add_field(){
            $("#emails_form").append($("#new_emails_form").html());
        }

        function update_form(){
            $("#emails_form .input-field:nth-last-child(2)")
                .unbind('keydown', key_press_check);
            $("#emails_form .input-field:last")
                .bind('keydown', key_press_check);
            $('.clear_email').click(function () {
                console.log("clicked");
                $(this).parent().remove();
            });
        }
    });
</script>